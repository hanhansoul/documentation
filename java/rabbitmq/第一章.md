#

## 消费者和生产者

生产者创建消息，然后发布到代理服务器RabbitMQ中。

消息包含两部分内容：有效负载和标签。
- 有效负载：需要传输的数据，可以使任何内容。
- 标签：用于描述有效负载。

消费者连接到代理服务器上，并订阅到队列上接收消息。

### 信道

在连接到RabbitMQ时，应用程序可以创建一条AMQP信道，AMQP命令都是通过信道发送出去的。

每条信道都会被指派一个唯一ID。

发布消息、订阅队列或者是接受消息，都是通过信道完成的。

如果直接使用TCP连接发送AMQP命令，创建与销毁TCP会话是巨大的开销。

## 队列

AMQP消息路由包含三个部分：交换器、队列和绑定。

消费者通过以下两种方式从特定的队列中接收消息：
1. 通过basic.consume命令订阅。信道被置为接收模式，知道取消订阅为止。
2. 通过basic.get命令从队列中获取单条消息而不是持续订阅。

如果消息到达无人订阅的队列，消息会在队列汇中等待，知道有消费者订阅给队列为止。

当队列拥有多个消费者时，队列收到的消息将以循环的方式发送给消费者，每条消息只会发送给一个订阅的消费者。

队列是AMQP消息通信的基础模块
1. 为消息提供了处所，消息再次等待被消费。
2. 队列提供了负载均衡支持，RabbitMQ将以循环的方式均匀的分配发送来的消息。
3. 队列是RabbitMQ中消息的最后终点。

## 交换器和绑定

交换器类型
1. direct
2. fanout
3. topic
4. headers

**direct**

如果路由键匹配，消息就被投递到对应的队列。

**fanout**

当发送一个消息到fanout交换器时，消息会被投递到所哟附加在此交换器上的队列。允许应用应用程序对单条消息做不同方式的反应。

**topic**

## 虚拟主机与隔离

每一个RabbitMQ服务器都能创建虚拟消息服务器，即虚拟主机vhost。

每一个vhost都如同一个迷你的RabbitMQ服务器，通过在各个实例间提供逻辑上的分离，允许你为不同应用程序安全保密地运行数据。

### 持久化

AMQP事务

AMQP中，将信道设置为事务模式后，通过信道发送需要确认的消息，之后还有多个其他AMQP命令。这些命令执行还是