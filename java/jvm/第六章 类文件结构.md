# 类文件结构

## 概述

各种平台的虚拟机与所有平台都统一使用的程序存储格式——字节码是构成平台无关性的基础。

## Class类文件的结构

Class文件是一组以8位字节为基础单位的二进制刘，各数据项目严格按照顺序紧凑的排列在Class文件中，其中没有任何分隔符。

Class文件格式采用类似于C语言结构体的伪结构存储，这种伪结构中只有两种数据类型：无符号数和表。

无符号数属于基本数据类型，以u1、u2、u4、u8分别表示1、2、4、8个字节。用来描述数字、索引引用、数量值或字符串值。

表由多个无符号数或其他表作为数据项构成的复合数据类型，所有表一般以_info结尾。用于描述有层次关系的复合结构数据。Class文件本质上就是一张表。

1. 版本号
2. 常量池：字面量和符号引用
3. 访问标志
4. 类索引、父类索引与接口索引集合
5. 字段表集合
6. 方法表集合
7. 属性表集合


### 魔数

Class文件的头4个字节被称为魔数，用于确定这个文件是否为一个能被虚拟机接受的Class文件。

魔数后的四个字节为Class文件的版本号。

### 常量池

版本号之后的是常量池入口，常量池是Class文件结构中与其他项目关联最多的数据类型，也是占用Class文件空间最大的数据项目之一。是一个表类型数据结构。

常量容量计数值。

常量池中存储两大类常量：
1. 字面量：如文本字符串、被声明为final的常量值等。
2. 符号引用：
	1. 类和接口的全限定名
	2. 字段的名称和描述符
	3. 方法的名称和描述符

java进行编译时，不会像C或C++一样有“连接”步骤，而是在虚拟机加载Class文件的时候进行动态连接。Class文件中不会保存各个方法和字段的内存布局信息，虚拟机运行时，需要从常量池获得对应的符号引用，再在类创建时或运行时解析并翻译到具体的内存地址中。

### 访问标志

常量池之后，紧接着2个字节代表访问标志，用于识别一些类或接口层次的访问信息，包括：这个Class是类还是接口，是否定义为public类型，是否定义为abstract类型，是否被声明为final等。

### 类索引、父类索引与接口索引集合

类索引、父类索引与接口索引集合用于确定这个类的继承关系。

### 字段表集合

字段表用于描述接口或类中声明的变量。字段包括类级变量或实例级变量，但不包括在方法内部声明的变量。

### 方法表集合

### 属性表集合

