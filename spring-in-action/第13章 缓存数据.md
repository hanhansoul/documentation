# 缓存数据

Spring对缓存的支持有两种方式：
1. 注解驱动的缓存
2. XML声明的缓存

通过@EnableCaching启用注解驱动的缓存

	@Configuration
	@EnableCaching
	public vlass CachingConfig {
		@Bean
		public CacheManager cacheManager() {
			return new ConcurrentmapCacheManager();
		}
	}

该注解会创建一个切面并触发spring缓存注解的切点，根据所使用的注解以及缓存装填，这个切面会从缓存中获取数据，将数据添加到缓存之中或者从缓存中移除某个值。

缓存管理器是spring缓存抽象的核心，能够与多个流行的缓存实现进行集成。

缓存管理器：
1. SimpleCacheManager
2. NoOpCacheManager
3. ConcurrentMapCacheManager
4. CompositeCacheManager
5. EhCacheCacheManager
6. RedisCacheManager
7. GemfireCacheManager

### EhCache

	@Configuration
	@EnableCaching
	public vlass CachingConfig {
		@Bean
		public EhCacheCacheManager cacheManager(CacheManager cm) {
			return new EhCacheCacheManager(cm);
		}

		@Bean
		public EhCacheManagerFactoryBean ehcache() {
			EhCacheManagerFactoryBean ehCacheFactoryBean = 
				new EhCacheManagerFactoryBean();
			chCacheFactoryBean.setConfigLocation(
				new ClassPathResource("ehcache.xml"));
			return ehCacheFactoryBean;
		}
	}

### 使用redis缓存

通过传递一个RedisTemplate实例作为其构造器参数构建一个RedisCacheManager。

	@Configuration
	@EnableCaching
	public class CachingConfig {
		@Bean
		public CacheManager cacheManager(RedisTemplate redisTemplate) {
			return new RerdisCacheManager(redisTemplate);
		}

		@Bean
		public JedisConnectionFactory redisConnectionFactory() {
			JedisConnectionFactory jedisConnectionFactory = 
				new JedisConnectionFactory();
			jedisConnectionFactory.afterPropertiesSet();
			return JedisConnectionFactory;
		}

		@Bean
		public RedisTemplate<String, String> redisTemplate(
			RedisConnectionFactory redisCF) {
			RedisTemplate<String, String> redisTemplate = 
				new RedisTemplate<>();
			redisTemplate.setConnectionFactory(redisCF);
			redisTemplate.afterPropertiesSet();
			return redisTemplate;
		}
	}

### 使用多个缓存管理器

CompositeCacheManager通过一个或多个缓存管理器来进行配置，迭代这些缓存管理器，以查找之前所缓存的值。

	public CacheManager cacheManager(
		net.sf.chcache.CacheManager cm,
		javax.cache.CacheManager jcm) {
		CompositeCacheManager cacheManager = new ArrayList<CacheManager>();
		List<CacheManager> managers = new ArrayList<>();
		managers.add(new JCacheCacheManager(jcm));
		managers.add(new EhCacheCacheManager(cm));
		managers.add(new RedisCacheManager(redisTemplate()));
		cacheManager.setCacheManagers(managers);
		return cacheManager;
	}

## 